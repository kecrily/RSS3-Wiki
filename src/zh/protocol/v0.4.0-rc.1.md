# RSS3 Protocol v0.4.0-rc.1

## 1. 摘要

创造、传播和分发信息的权利属于人们，它不应被中心化平台所掌控。这是网络时代人们生活所需最基本的权利。

在过去的 20 年里，内容及其传播渠道逐渐被几个数据寡头所控制，这形成了一种有害的中心化氛围，为了利润而牺牲了隐私和自由，这种氛围进一步阻碍了创新：无论你的设计和程序写得有多好，你的应用程序都无法与数据垄断者公平竞争。

世界始终渴望一种崭新的信息聚合方式。RSS 曾是那个时代的先锋，现在是时候由我们接过接力棒并继续前进探索了。

取 RSS 之精华而成的 RSS3 是一个开放的信息组织分发协议，致力于在 Web3 中高效和去中心化地传播信息。

本文档定义了加密技术体系下去中心化账户间的聚合格式和信息交互方法。

## 2. 文档状态

虽然理论上本协议已完备，但该版本仍处于 beta 阶段，需要在实际应用中检验。因此，团队无法保证本文档与后续版本相互兼容，但会尽量在后续更新中保持连贯性。

## 3. 依赖

- [RFC 3986 - Uniform Resource 标识符 (URI): Generic Syntax](https://datatracker.ietf.org/doc/html/rfc3986): The protocol uses a large number of RFC 3986 Uniform Resource 标识符s to identify things in RSS3.
- [RFC 6838 - Media Type Specifications and Registration Procedures](https://datatracker.ietf.org/doc/html/rfc6838): The value of the item.attachment.mime_type field in the protocol uses the RFC 6838 standard.
- [JSON Schema: A Media Type for Describing JSON Documents](https://datatracker.ietf.org/doc/html/draft-bhutton-json-schema-00): The protocol provides the user with a series of JSON Schema to do format validation.
- [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601): All times appearing in the protocol use the extended ISO 8601 format with 3 decimals (YYYY-MM-DDTHH:mm:ss.sssZ).

## 4. 主要概念

### 4.1. 文件

用户提交的数据将是适配 RSS3 的 JSON 文件， RSS3 网络则会返回数据。文件分为索引文件及其附属的列表文件。可在[用例](#_6-用例)处浏览文件的全貌。

RSS3 文件的 mime 类型是 `application/rss3+json`。建议在 RSS3 文件的响应头中包含 `content-type: application/rss3+json; charset=utf-8`。

#### 4.1.1. 基础文件

每个文件具有一些基本属性。

```ts
type FileBase = {
    version: 'v0.4.0';
    identifier: InstanceURI | CustomItemListURI | AggregatedItemListURI | CustomLinkListURI | AggregatedLinkListURI | BacklinkListURI;
    date_created: string;
    date_updated: string;
} & (SignedBase | UnsignedBase);
```

##### 4.1.1.1. `version`

协议版本，当前版本是 `v0.4.0`。

##### 4.1.1.2. `identifier`

当前文件的 URI：若是在查询场景下需包含查询。

##### 4.1.1.3. `date_created` 和 `date_updated`

文件创建或更新时的时间戳：使用三位小数形式的 ISO 8601 日期扩展格式（YYYY-MM-DDTHH:mm:ss.sssZ）。

##### 4.1.1.4. SignedBase 和 UnsignedBase

详见[鉴权](#_4-8-鉴权)。

#### 4.1.2. 索引文件

索引文件时实例的主要切入点，其掌握着实例的一般性信息，包括[资料](#资料)的细节、[链接](#_4-6-link)的 URI 或者[项目](#_4-5-项目)列表等。

```ts
type IndexFile = FileBase & {
    profile?: Profile;
    links: LinksSet;
    items: ItemsSet;
}
```

##### 4.1.2.1. `profile`、`links` 和 `items`

- [资料](#_4-7-profile)
- [链接](#_4-6-link)
- [项目](#_4-5-item)

#### 4.1.3. 列表文件

列表文件用于存储列表数据，包括各种项目列表和链接列表。

| Type | Signed | URI | List Element |
| --- | --- | --- | --- |
| Custom 项目列表 | true | `CustomItemListURI` | `Item` |
| Aggregated 项目列表 | false | `AggregatedItemListURI` | `Item` |
| Custom 链接列表 | true or false | `CustomLinkListURI` | `InstanceURI` |
| Aggregated 链接列表 | false | `AggregatedLinkListURI` | `InstanceURI` |
| 反链列表 | false | `BacklinkListURI` | `InstanceURI` |

```ts
type ListFile<URIType, ElementType> = FileBase & {
    identifier: URIType;
    identifier_next?: URIType;

    total: number;
    list?: ElementType[];
}

// for items
type CustomItemList = SignedBase & ListBase<CustomItemListURI, Item>;
type AggregatedItemList = UnsignedBase & ListBase<AggregatedItemListURI, Item>;

// for links
type CustomLinkList = (SignedBase | UnsignedBase) & ListBase<CustomLinkListURI, InstanceURI>;
type AggregatedLinkList = UnsignedBase & ListBase<AggregatedLinkListURI, InstanceURI>;
type BacklinkList = UnsignedBase & ListBase<BacklinkListURI, InstanceURI>;
```

##### 4.1.3.1. `list`

列表元素，可以是项目、链接、反链等，由列表文件的种类决定。

##### 4.1.3.2. `identifier_next`

标识下一页的 URI。 若未指定，默认当前页是最后一页。

如：

```json
{
    "identifier":      "rss3://account:0xtest@ethereum/list/note/1",
    "identifier_next": "rss3://account:0xtest@ethereum/list/note/0"
}
{
    "identifier":      "rss3://account:0xtest@ethereum/list/note?limit=5",
    "identifier_next": "rss3://account:0xtest@ethereum/list/note?limit=5&last_time=2022-01-01T00:00:00Z"
}
```

##### 4.1.3.3. `total`

当前页和下一页的元素的总数。

### 4.2. 账号

为了保持开放和兼容，本协议不会创建一个新的账户系统。本协议兼容现存各个平台的账户系统，包括加密技术体系下去中心化化的平台和中心化平台。

有两种账户

主账户：实例 URI 中的账户，代表拥有者和文件签名人，且必须来自去中心化化平台。

- C连接的账户：`profile.account` 字段中的账户，代表属于实例的其它账户。

一个账户包含两份信息：账户 ID 和账户所属的平台。

```xsl
Account = <identity>@<account_platform>
```

- `identity` 是平台中的唯一账户 ID；
- `account_platform` 由 [RSS3 改进案-1: 在册用户平台](./RIPs/RIP-1.md) 定义。

如,

- 一个以太坊账户表示为 `0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum`。

- 一个 Twitter 账户表示为 `DIYgod@twitter`。

### 4.3. Instance

一个实例是一个 RSS3 交互性对象，即包含一个 RSS3 索引文件和其附属列表文件的 RSS3 显性单元。

```xsl
Instance = <prefix>:<identity>@<platform>
```

- `prefix` is one constant of `account`, `asset`, `note`;
- `platform` is the platform to which the instance belongs. The platform of account is defined by [RIP-1: Registered Account Platforms](./RIPs/RIP-1.md), and the platform of item is defined by [RIP-3: Registered Item Networks](./RIPs/RIP-3.md) and [RIP-4: Registered Indexed Items](./RIPs/RIP-4.md);
- `identity` is the unique ID of the instance on this platform.

#### 4.3.1. 账号实例

账户实例是指由一个账户创建的一个实例。

```xsl
AccountInstance = account:<account_identity>@<account_platform>
```

如,

- `account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum`
- `account:DIYgod@twitter`

#### 4.3.2. 项目实例

在继续前，你可能需要事先了解一下[项目种类](#_4-5-1-项目类型)。

项目实例是指为项目构造的实例。

```xsl
ItemInstance = CustomItemInstance | IndexedItemInstance

IndexedItemInstance = {asset|note}:<metadata_proof>@<item_network>
CustomItemInstance  = {asset|note}:<account_platform>-<account_identity>-<item_date_created_timestamp>@rss3
```

::: warning
唯一 ID 一般由 `date_created` 构成，这表示在一个账户实例下不会存在相同 `date_created` 的两个项目。
:::

如,

- `asset:0xacbe98efe2d4d103e221e04c76d7c55db15c8e89-5@ethereum`
- `note:ethereum-0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944-1647280857187@rss3`

### 4.4. 标识符

本协议使用一组基于 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986) 标准的统一资源标识符（URI）来标识 RSS3 中的事项，诸如实例标识符、项目标识符和列表标识符。 用户可以使用 RSS3 URI 来获取其所标识的项目或一个链接所指向的目标。

#### 4.4.1. Scheme

The scheme is `rss3`. I.e. RSS3 URI starts with `rss3://`.

#### 4.4.2. 主体

本协议使用[实例](#_4-3-instance)作为主体。

#### 4.4.3. URI

以下展示了每个 URI 的组成部分。

##### 4.4.3.1. 实例 URI

```xsl
InstanceURI = AccountInstanceURI | ItemInstanceURI

AccountInstanceURI = rss3://<AccountInstance>
ItemInstanceURI = rss3://<ItemInstance>
```

示例：

- 账号实例 URI

    ```text
    rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum
    ```

- 资产实例 URI

    ```text
    rss3://asset:0xb9619cf4f875cdf0e3ce48b28a1c725bc4f6c0fb-1024@ethereum
    ```

- 帖子实例 URI

    ```text
    rss3://note:1483972580616949762@twitter
    ```

##### 4.4.3.2. 项目列表 URI

```xsl
CustomItemListURI     = rss3://<Instance>/list/{note|asset}/<page_index>
AggregatedItemListURI = rss3://<Instance>/list/{note|asset}[?<query_string>]
```

若存在 `page_index`，则该列表是用于页面导航的可定制项目列表。起始索引 `page_index` 是 `0`。

若不存在 `page_index`，则该列表是一个聚合项目列表，可同时包含可定制项目和被索引项目。

> 请至[项目](#_4-5-项目)了解更多。

可用参数：

| Key | Usage |
| --- | --- |
| limit | 在页面导航中用于限制返回项目的数量。在执行时应指定最大和最小值。. |
| last_time | 用于页面导航。应是基于 ISO 8601 标准的时间值。若指定，则仅返回该时间之前的项目。 |
| link_type | 若指定，则仅返回相应链接种类的项目。 |
| filter_tags | 若指定，则仅返回相应标签的项目（利用项目属性 `tags` 进行过滤）。多个值用逗号分隔。 |
| filter_auto | 若为真，则仅返回 `auto` 字段设定为真的项目。若为假，则相反。若不可用，不会应用该类过滤器。 |
| filter_network | 若指定，则仅返回过滤器列表中标记有 `metadata.network` 字段的项目。多个值用逗号分隔。 |
| filter_mime_types | 若指定，则仅返回 `attachments.mime_type` 字段符合相应指定值的项目。多个值用逗号分隔。 |

示例：,

- 第二个列表页中的可定制帖子列表：

    ```text
    rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/note/1
    ```

- 前 5 个帖子的列表：

    ```text
    rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/note?limit=5
    ```

- 该实例关注的实例们的帖子列表：

    ```text
    rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/note?link_type=following
    ```

##### 4.4.3.3. 链接列表 URI

```xsl
CustomLinkListURI     = rss3://<Instance>/list/link/<link_type>/<page_index>
AggregatedLinkListURI = rss3://<Instance>/list/link/<link_type>[?<query_string>]
```

`link_type` 由 [RSS3 改进案-5: 在册链接类型](./RIPs/RIP-5.md)定义。

可用参数：

| Key | Usage |
| --- | --- |
| limit | 在页面导航中用于限制返回项目的数量。在执行时应指定最大和最小值。. |
| last_instance | 用于页面导航。若指定，则仅返回该实例之后的实例。 |
| instance | 若指定，则仅返回含有该实例的列表。若指定实例后没有列表满足条件，则返回空。 |

示例：

- 第二个列表页中的关注链接列表：

    ```text
    rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/link/following/1
    ```

- 前 5 个实例中的关注链接列表：

    ```text
    rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/link/following?limit=5
    ```

- 查询是否一个实例被另一个实例关注：

    ```text
    rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/link/following?instance=0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944
    ```

##### 4.4.3.4. 反链列表 URI

```xsl
BacklinkListURI = rss3://<Instance>/list/backlink[?<query_string>]
```

可用参数：

| Key | Usage |
| --- | --- |
| type | Returning only backlinks of this type. |
| limit | 在页面导航中用于限制返回项目的数量。在执行时应指定最大和最小值。. |
| last_instance | 用于页面导航。若指定，则仅返回该实例之后的实例。 |
| instance | 若指定，则仅返回含有该实例的列表。若指定实例后没有列表满足条件，则返回空。 |

示例：

- 前 5 个实例的关注列表：

    ```text
    rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/backlink?type=following&limit=5
    ```

- 查询一个实例是否关注另一个实例：

    ```text
    rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/backlink?type=following&instance=0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944
    ```

- 一个帖子的评论：

    ```text
    rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/notes/5591079b-1f5b-4ae9-8209-51b18f0d3be0/list/backlink/comment
    ```

### 4.5. 项目

项目是一个由实例自动或被动生成的操作或物资。协议不能预测其内容是什么种类，所以协议力求将其定义得宽泛而不受限。项目可以是一篇博客日志，一个 NFT，或一个商品，一个游戏活动，等等。

#### 4.5.1. 项目类型

##### 4.5.1.1. 根据项目来源

- 被索引的项目：由 [RSS3 改进案-4: 在册索引项目](./RIPs/RIP-4.md)所定义，基于主账户和绑定账号，被 RSS3 网络从其它网络或平台自动索引的项目。

- 可定制项目：由用户自己签名或提交的项目。

##### 4.5.1.1. According to content

- 资产：由实例所拥有的资产，可根据不同的使用场景扩展或理解为任意一种固定的展示内容，比如一个 NFT、一个游戏成就、一个物理实例，一个待售商品，等等。.

- 帖子：由实例生成的操作或事件，并可以根据不同的使用场景扩展或理解为任意一种信息流内容，比如获得 NFT 的动态，撰写一份论坛日志，发表对其它项目的回复，等等。

#### 4.5.2. 项目概况

在索引文件中可以看到项目的结构：

```ts
type ItemsSet = {
    notes: {
        identifier_custom?: CustomItemListURI;
        identifier: AggregatedItemListURI;
        filters?: Filters;
    };
    assets: {
        identifier_custom?: CustomItemListURI;
        identifier: AggregatedItemListURI;
        filters?: Filters;
    };
};
```

##### 4.5.2.1. `items.assets`

`assets` 是实例所拥有的项目，可根据不同的使用场景扩展或理解为任意一种固定的展示内容，比如一个 NFT、一个游戏成就、一个物理实例，一个待售商品，等等。

##### 4.5.2.2. `items.notes`

`notes` 是由实例生成的操作或事件，并可以根据不同的使用场景扩展或理解为任意一种信息流内容，比如获得 NFT 的动态，撰写一份论坛日志，发表对其它项目的回复，等等。

##### 4.5.2.3. `items.x.identifier_custom`

`identifier_custom` 记录最后一页上的可定制项目列表的 URI，列表元素为用户自己提交的项目。
当只有一页内容时， `identifier_custom` 的值为 `rss3://<Instance>/list/{note|asset}/0` ，直到内容超过了 RSS3 网络设定的文件大小限制。 然后新项目将在一个 URI 为 `rss3://<Instance>/list/{note|asset}/1` 的新文件中记录，且 `identifier_custom` 字段变更为 `rss3://<Instance>/list/{note|asset}/1`。

##### 4.5.2.4. `items.x.identifier`

`identifier` 是包含可定制项目和被索引项目的聚合项目列表的 URI，按 `date_created` 排序，最新的项目位于顶部。其支持若干查询。

##### 4.5.2.5. `items.x.filters`

`filters` 用于过滤由 `identifier` 返回的**索引项目**，以满足用户选择性显示的需求。

它可以过滤 `item.tags` 和 `item.metadata.network` 两个字段。

```ts
type Filters = {
    blocklist?: string[];
    allowlist?: string[];
}
```

###### 4.5.2.5.1. `items.x.filters.blocklist`

含有该列表中指定值的项目或反链将不被返回，例如，`blocklist: ["twitter"]` 的情景下，`item.tags` 和 `item.metadata.network` 两个字段中含有 `twitter` 的项目不会被 AggregatedItemListURI 返回。

###### 4.5.2.5.2. `items.x.filters.allowlist`

仅返回含有该列表中指定值的项目或反链，例如，`allowlist: ["twitter"]` 的情景下，只有 `item.tags` 和 `item.metadata.network` 两个字段中含有 `twitter` 的项目会被 AggregatedItemListURI 返回。

#### 4.5.3. 项目细节

```ts
type Item = {
    identifier: ItemInstanceURI;
    date_created: string;
    date_updated: string;

    auto?: true;
    related_urls?: string[];

    links: LinksSet;

    tags?: string[];
    authors: Account[];
    title?: string;
    summary?: string;
    attachments?: Attachment[];

    metadata?: {
        network: NetworkName;
        proof: string;

        [key: string]?: any;
    };
};
```

##### 4.5.3.1. `item.date_created`

基于 ISO 8601 标准的操作或项目生成的时间，例如文章发布的时间、 NFT 铸造的时间、产品上架的时间、NFT 获得的时间（在帖子中，其说明操作生成的时间），等等。

##### 4.5.3.2. `item.date_updated`

基于 ISO 8601 标准的操作或项目更新的时间，例如文章更新的时间，NFT 获取的时间（在资产中，其说明项目变更的时间），等等。

##### 4.5.3.3. `item.auto`

若为真，则表示其为一个被索引的项目，而非一个可定制的项目。

##### 4.5.3.4. `item.related_urls`

仅可定制的项目具有该字段，应含有项目有关的链接，例如在被索引网络中的项目的地址。

##### 4.5.3.5. `item.identifier`

`identifier` 是项目的 URI。见 [实例 URI](#_4-4-3-1-实例-uri)。

##### 4.5.3.6. `item.links`

详见[链接](#链接).

##### 4.5.3.7. `item.tags`

`tags` 是一组字串。就像博客中常用的标签概念一样，你可以给一篇文章增加多个标签。被索引的项目也有标签，用来说明项目的种类，可指定的值由[RSS3 改进案-4: 在册索引项目](./RIPs/RIP-4.md)所限。

##### 4.5.3.8. `item.authors`

`authors` 是一组账户名，说明产出该项目的账户，例如文章的作者、产品的卖家，等等。若当前实例地址即为作者，该字段可忽略。

若项目是一个被索引项目且作者是一个绑定账号，那该字段将额外包含主账户。

##### 4.5.3.9. `item.title` 和 `item.summary`

`summary` 的内容不能太长。RSS3 网络应设定最大长度。

对短内容而言，其有可能只含有没有 `title` 的 `summary`，例如来自 Twitter 的推文。

对字数超过长度限制的长文章而言，其 `summary` 只能是一个概要或长文章的片段，完整内容应放置于 `attachments`。

##### 4.5.3.10. `item.attachments`

`attachments` 记录了项目的附件，如文章的图片等。若项目是长文章，则该字段可以含有该文章的全文。

该字段是一组附件，每个元素的结构如下：

```ts
type Attachment = {
    type?: string;
    content?: string;
    address?: URI;
    mime_type: string;
    size_in_bytes?: number;
}
```

###### 4.5.3.10.1. `item.attachments[i].type`

附件的种类，用于说明该附件的功能或类型，例如缩略图、详细描述，等等。

该值可以是任意字符串。

###### 4.5.3.10.2. `item.attachments[i].content` 和 `item.attachments[i].address`

`content` 是附件的具体内容，例如文章整体或一幅图片的 base64 字符串。出于保护整个网络，避免影响存储效率的目的，即使该内容可以非常长，但 RSS3 网络仍会限定该内容的最大长度。超过最大长度限制的内容需要使用第三方空间存储于地址字段。

`address` 是该附件指向第三方地址的 URI，例如一个 markdown 文件地址或一个图片地址。

`content` 和 `address` 不可兼有。一个附件有且仅有二者之一。

###### 4.5.3.10.3. `item.attachments[i].mime_type`

该字段记录附件的媒体种类。其值需要符合 RFC 6838 标准，例如 `image/png`、 `text/markdown` 等等。从应用表达的实用角度出发，这是一个重要但易被忽视的字段，所以协议将其指定为必须包含。

###### 4.5.3.10.4. `item.attachments[i].size_in_bytes`

该字段用字节数记录附件的大小，对于显示视频和音频等大文件十分有用。同时该字段也易被忽略，因此协议建议尽可能确保该值存在且正确。

##### 4.5.3.11. `item.metadata`

该字段用 [RSS3 改进案-4: 在册索引项目](./RIPs/RIP-4.md)中指定的值记录被索引项目的元数据。

###### 4.5.3.11.1. `item.metadata.network`

储存该项目的网络。

其值由 [RSS3 改进案-3: 在册项目网络](./RIPs/RIP-4.md)定义。

###### 4.5.3.11.2. `item.metadata.proof`

该字段记录索引该被索引项目的证书，例如交易哈希值和中心化平台的地址。

### 4.6. Link

其描述了 RSS3 中两个实例或项目间的关系。

#### 4.6.1. 项目类型

- 被索引链接：基于主账户或绑定账号，被 RSS3 网络自动从其它网络或平台索引的链接。
- 可定制链接：由用户自己签名或提交的链接，或者由索引项目实例自动索引的链接。

#### 4.6.2. Link Overall

链接字段存在于实例和项目中，两者皆包含 `links` 字段。内容如下：

```ts
interface LinksSet {
    identifiers?: {
        type: LinkType;
        identifier_custom: CustomLinkListURI;
        identifier: AggregatedLinkListURI;
    }[];
    identifier_back: BacklinkListURI;
}
```

##### 4.6.2.1. `links.identifiers.type`

关系类型，例如实例的关注关系、项目的评论关系，等等。其值由 [RSS3 改进案-5: 在册链接类型](./RIPs/RIP-5.md)限定。

##### 4.6.2.2. `links.identifiers.identifier_custom`

该字段记录在最后一页中可定制链接列表的 URI。

当只有一页内容时，`identifier_custom` 的值为 `rss3://<Instance>/list/link/0` ；直至内容超出了 RSS3 网络所限定的文件大小时，新链接将由 URI 为 `rss3://<Instance>/list/link/1` 的新文件记录，并且 `identifier_custom` 字段变更为 `rss3://<Instance>/list/link/1` 。

##### 4.6.2.3. `links.identifiers.identifier`

该字段是聚合链接列表的 URI，其支持若干查询。

##### 4.6.2.4. `links.identifier_back`

该字段记录该链接的反向关系。例如，若 A 记录了一个关注 B 的关系，那么 B 的 `identifier_back` 将自动记录一个 A 的反向关注 （即，被关注）关系。

#### 4.6.2. Link Details

```ts
type Link = {
    identifier_target: InstanceURI;
    type: LinkType;

    auto?: true;
    metadata?: Metadata;
};
```

##### 4.6.2.1. `link.identifier_target`

链接指向 RSS3 URI，可以是实例 URI 或 项目 URI。这表示用户可以关注一个 RSS3 账户，且可以评论一个 RSS3 资产或 RSS3 帖子。

##### 4.6.2.2. `link.type`

见 [links.identifier_back](#_4-6-2-4-links-identifier-back)。

### 4.7. Profile

资料位于一个索引文件的 `profile` 字段，其记录实例的基本信息，包括名称、头像、资料等。

```ts
type Profile = {
    name?: string;
    avatars?: URI[];
    bio?: string;
    attachments?: Attachment[];

    accounts?: Accounts;

    tags?: string[];
    metadata?: Metadata;
};
```

#### 4.7.1. `profile.name`

实例的名称，例如用户的显示名称、资产的名称。

#### 4.7.2. `profile.avatars`

实例的图标，例如用户的头像和资产图片。可同时设置为多个，应用应从中选择第一个来显示。

#### 4.7.3. `profile.bio`

对该实例的文字介绍。

#### 4.7.4. `profile.attachments`

当用于项目实例时，用法和 [item.attachments](#_4-5-3-10-item-attachments) 一致。

当用于账户实例时，`profile` 将是一种高度自由和多样的信息。协议无法预知所有的需求，所以仅定义了几种最常见的信息，并建议使用 `attachments` 字段来记录未明确定义的资料信息，如 `websites`、 `banner`。

如：

```json
{
    "attachments": [
        {
            "type": "websites",
            "content": "https://rss3.io\nhttps://diygod.me",
            "mime_type": "text/uri-list",
        },
        {
            "type": "banner",
            "content": "ipfs://QmT1zZNHvXxdTzHesfEdvFjMPvw536Ltbup7B4ijGVib7t",
            "mime_type": "image/jpeg",
        }
    ]
}
```

#### 4.7.5. `profile.accounts`

这是另一个用于记录实例绑定的[账户](#_4-2-account)，包括加密体系下去中心化平台和中心化平台的账户。

```ts
type Accounts = {
    identifier: AccountInstanceURI;
    signature?: string;
}[];
```

##### 4.7.5.1. `profile.accounts[i].identifier`

账户的 URI。若其是加密领字段的去中心化账户，请用 `profile.accounts[i].signature` 来验证所有权。若其是无法签名确认的中心化平台，用户必须将主账户的地址或字段名（请见 [RSS3 改进案-2: 在册字段名服务](./RIPs/RIP-2.md)）放于平台账户设置的某一位置以验证所有权。

#### 4.7.6. `profile.accounts[i].signature`

该字段用于验证关联用户的所有权，将由关联用户而非主账户签署。

```ts
profile.accounts[i].signature = sign(`[RSS3] I am adding account ${profile.accounts[i].identifier} to my RSS3 Instance ${InstanceURI}`);
```

#### 4.7.7. `profile.tags` and `profile.metadata`

就项目实例而言，用法与 [item.tags](#_4-5-3-7-item-tags) 和 [item.metadata](#_4-5-3-11-item-metadata) 相同。

### 4.8. Authentication

该套确权机制用于验证文件的正当性，包括 RSS3 网络中用户提交的文件、在去中心化执行中各节点间同步的文件和由 RSS3 网络返回客户端处的文件。

#### 4.8.1. SignedBase and UnsignedBase

文件被区分为已签文件和未签文件。每个文件含有一个名为 `SignedBase` 或 `UnsignedBase` 的字段以记录该文件的授权方法。

```ts
type SignedBase = {
    signature: string;
    agents?: {
        pubkey: string;
        signature: string;
        authorization: string;
        app: string;
        date_expired: string;
    }[];
    controller?: string;
}

type UnsignedBase = {
    auto: true;
}
```

- 已签文件使用 `SignedBase` 类型，服务于储存用户的签名授权数据。客户端将可以执行签名确认。已签文件包括账户实例的索引文件和可定制项目/链接列表文件。
- 未签文件使用 `UnsignedBase` 类型来储存由 RSS3 网络生成的数据。客户端需要根据相关的已签文件或 `metadata.proof` 字段来验证。未签文件包括聚合项目/链接列表文件，反向联系列表文件。

#### 4.8.2. `signature`

其位于一个已签文件的根路径，由实例的私钥签署。文件的 JSON 字段经由该值的字母表顺序排序后即为签名消息。签名算法可依据平台的不同而不同。使用哪种算法由[RSS3 改进案-1: 在册账户平台](./RIPs/RIP-1.md)定义。

请注意，在验证签名和计算签名消息时，已存在的 `signature` 字段需事先清除。

```ts
signatrue = sign(`[RSS3] I am confirming the results of changes to my file ${identifier}: ${SortedStringify(file)}`);
```

文件像是这样：

```json
{
    "version": "v0.4.0",
    "identifier": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum",
    "signatrue": "This should not be included",

    "items": {
        "notes": 1,
        "assets": 2
    }
}
```

其签名是： `[RSS3] I am confirming the results of changes to my file rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum: {"items":{"assets":2,"notes":1},"version":"v0.4.0"}`

#### 4.8.3. `agents`

::: danger
该特性可以显著降低安全性。协议将剔除该特性，或依据实际使用在未来版本中做出重大变更。
:::

其位于一个已签文件的根路径。其功能类似于 Web2 中的记住我。你可以使用主账户的签名来授权一个随机由本地生成的代理签名账户。当改动文件时，可用代理账户进行签名授权来降低用主账户签名的次数并降低使用的开销。

这同时意味着若代理账户的私钥暴露或应用方选择作恶，那该文件将彻底失去安全性。终端用户将不得不在应用中以完全信任重新授权该功能。

加密算法采用 Ed25519。

##### 4.8.3.1. `agents[i].pubkey`

代理账户的公钥的 base64 值，由客户端生成。

##### 4.8.3.2. `agents[i].signature`

代理账户的私钥的 base64 值。签名消息与 `signature` 一致。类似的，在计算时，当前代理人原已存在的 `agents[i].signature` 应被清除。

##### 4.8.3.3. `agents[i].authorization`

当技术上足够使用根 `signature` 来验证代理人的真实性时，增加 `agents[i].authorization` 能通过让用户对该警示消息进行签名来提醒用户关于代理人的风险。

用于区分不同代理账户的应用名。

```ts
agents.signatrue = sign(`[RSS3] I am well aware that this APP (name: ${app}) can use the following agent instead of me (${InstanceURI}) to modify my files and I would like to authorize this agent (${pubkey})`);
```

##### 4.8.3.4. `agents[i].app`

用于区分不同代理账户的应用名。

##### 4.8.3.5. `agents[i].date_expired`

代理账户的过期时间， RSS3 网络应设置其最大限值。过期后，代理账户应被删除。

#### 4.8.4. `controller`

保留字段，用于定义文件的控制器，暂未启用。

当前计划是使用一个合约来在不同场景下控制文件的控制器，例如在论坛中需要多人去一起改动同一个文件。

## 5. 验证

### 5.1. TypeScript

```ts
// Instance
type AccountInstance = string;
type ItemInstance = string;

type Instance = AccountInstance | ItemInstance;

// URI
type InstanceURI = string;

type CustomItemListURI = string;
type AggregatedItemListURI = string;

type CustomLinkListURI = string;
type AggregatedLinkListURI = string;
type BacklinkListURI = string;

type URI = string;

// Common attributes for each files
interface Base {
    version: 'v0.4.0';
    identifier: InstanceURI | CustomItemListURI | AggregatedItemListURI | CustomLinkListURI | AggregatedLinkListURI | BacklinkListURI;
    date_created: string;
    date_updated: string;
}

interface SignedBase extends Base {
    signature: string;
    agents?: {
        pubkey: string;
        signature: string;
        authorization: string;
        app: string;
        date_expired: string;
    }[];
    controller?: string;
}

interface UnsignedBase extends Base {
    auto: true;
}

// Base types
interface Attachment {
    type?: string;
    content?: string;
    address?: URI;
    mime_type: string;
    size_in_bytes?: number;
}

interface Metadata {
    network?: NetworkName;
    proof: string;

    [key: string]: any;
}

interface Filters {
    blocklist?: string[];
    allowlist?: string[];
}

interface LinksSet {
    identifiers?: {
        type: LinkType;
        identifier_custom: CustomLinkListURI;
        identifier: AggregatedLinkListURI;
    }[];
    identifier_back: BacklinkListURI;
}

// RSS3 index files, main entrance for a instance
interface Index extends SignedBase, UnsignedBase {
    identifier: InstanceURI;

    profile?: {
        name?: string;
        avatars?: URI[];
        bio?: string;
        attachments?: Attachment[];

        accounts?: {
            identifier: InstanceURI;
            signature?: string;
        }[];

        tags?: string[];
        metadata?: Metadata;
    };

    links: LinksSet;

    items: {
        notes: {
            identifier_custom?: CustomItemListURI;
            identifier: AggregatedItemListURI;
            filters?: Filters;
        };
        assets: {
            identifier_custom?: CustomItemListURI;
            identifier: AggregatedItemListURI;
            filters?: Filters;
        };
    };
}

// items
type Item = {
    identifier: ItemInstanceURI;
    date_created: string;
    date_updated: string;

    auto?: true;
    related_urls?: string[];

    links: LinksSet;

    tags?: string[];
    authors: Account[];
    title?: string;
    summary?: string;
    attachments?: Attachment[];

    metadata?: Metadata;
};

type Link = {
    identifier_target: InstanceURI;
    type: LinkType;

    auto?: true;
    metadata?: Metadata;
};

// RSS3 list files
type ListBase<URIType, ElementType> = {
    identifier: URIType;
    identifier_next?: URIType;

    total: number;
    list?: ElementType[];
}

type CustomItemList = SignedBase & ListBase<CustomItemListURI, Item>;
type AggregatedItemList = UnsignedBase & ListBase<AggregatedItemListURI, Item>;

type CustomLinkList = (SignedBase | UnsignedBase) & ListBase<CustomLinkListURI, Link>;
type AggregatedLinkList = UnsignedBase & ListBase<AggregatedLinkListURI, Link>;
type BacklinkList = UnsignedBase & ListBase<BacklinkListURI, Link>;
```

### 5.2. JSON Schema

TODO

## 6. 用例

### 6.1. 索引文件示例

URI `rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum`

```json
{
    "version": "v0.4.0",
    "identifier": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum",
    "date_created": "2021-08-17T14:36:00.676Z",
    "date_updated": "2022-02-10T22:50:53.132Z",

    "signature": "0x85d66b17df7343364c6b89ede6ff15279505abfdfa7b8c70590d53a3a10db97a504b8a2536a7dcc12527af42f28f643a258d48f395b8fa5917336f06d8972be41c",
    "agents": [
        {
            "pubkey": "rrqJ2xn7oUd4wGW8VbsZk9XeacYMap4/jprIA5b35ns=",
            "signature": "PObUwUA+BEStJZJoY4xBsOkQujsRAZ4yULZIu0orDHCID2ezI5/eD8EskIK+RFNvSCp9tKTSYqurEFa2egW6Dg==",
            "authorization": "",
            "app": "Revery",
            "date_expired": "2023-02-10T22:50:53.132Z"
        }
    ],

    "profile": {
        "name": "DIYgod",
        "avatars": [
            "ipfs://QmT1zZNHvXxdTzHesfEdvFjMPvw536Ltbup7B4ijGVib7t"
        ],
        "bio": "Cofounder of RSS3.",
        "attachments": [
            {
                "type": "websites",
                "content": "https://rss3.io\nhttps://diygod.me",
                "mime_type": "text/uri-list",
            },
            {
                "type": "banner",
                "content": "ipfs://QmT1zZNHvXxdTzHesfEdvFjMPvw536Ltbup7B4ijGVib7t",
                "mime_type": "image/jpeg",
            }
        ],

        "accounts": [
            {
                "identifier": "rss3://account:0x8768515270aA67C624d3EA3B98CA464672C50183@ethereum",
                "signature": "0x4828da56a162b9504dca6009864a90ed0ca3e56256d8458af451874ad7dd9cb26be4f399a56a8b69a881297ba6b6434a7f2f4a4f3557890d1efa8490769187be1b"
            },
            {
                "identifier": "rss3://account:DIYgod@twitter"
            }
        ]
    },

    "links": {
        "identifiers": [
            {
                "type": "following",
                "identifier_custom": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/link/following/1",
                "identifier": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/link/following"
            },
        ],
        "identifier_back": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/backlink"
    },

    "items": {
        "notes": {
            "identifier_custom": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/note/0",
            "identifier": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/note",
            "filters": {
                "blocklist": [
                    "Twitter"
                ]
            }
        },
        "assets": {
            "identifier_custom": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/asset/0",
            "identifier": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/asset",
            "filters": {
                "allowlist": [
                    "Polygon"
                ]
            }
        }
    }
}
```

### 6.2. Link 列表文件示例

URI `rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/link/following/1`

```json
{
    "version": "v0.4.0",
    "identifier": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/link/following/1",
    "identifier_next": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/link/following/0",
    "date_created": "2021-08-17T14:36:00.676Z",
    "date_updated": "2022-02-10T22:50:53.132Z",

    "signature": "0x5b2387a7e1b2ceb1a1b0c177294ca480ec1f43a21ad627476951b0c69baece500bde043d6f3a8ff1a8e248e3216517316b397806f6a6e721df50ed43479d65651c",

    "total": 8,
    "list": [
        {
            "identifier_target": "rss3://account:0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045@ethereum",
            "type": "following"
        },
        {
            "identifier_target": "rss3://asset:1B599C2B-5153-5DFC-8909-25AE1D51E801@rss3",
            "type": "following"
        },
        {
            "identifier_target": "rss3://note:1483972580616949762@twitter",
            "type": "following"
        },
        {
            "identifier_target": "rss3://asset:0xacbe98efe2d4d103e221e04c76d7c55db15c8e89-5@ethereum",
            "type": "following"
        }
    ]
}
```

### 6.3. 资产列表文件示例

URI `rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/asset/0`

```json
{
    "version": "v0.4.0",
    "identifier": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/asset/0",
    "date_created": "2021-08-17T14:36:00.676Z",
    "date_updated": "2022-02-10T22:50:53.132Z",

    "signature": "0x5b2387a7e1b2ceb1a1b0c177294ca480ec1f43a21ad627476951b0c69baece500bde043d6f3a8ff1a8e248e3216517316b397806f6a6e721df50ed43479d65651c",

    "total": 1,
    "list": [
        {
            "identifier": "rss3://asset:D52DCF9F-7FF0-400A-9562-66C87DB3A866@rss3",
            "date_created": "2021-08-17T14:36:00.676Z",
            "date_updated": "2022-02-10T22:50:53.132Z",

            "links": {
                "identifier_back": "rss3://asset:D52DCF9F-7FF0-500A-9562-66C87DB3A866@rss3/list/backlink"
            },
        
            "tags": [
                "Garage Kit"
            ],
            "authors": [
                "0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum"
            ],
            "summary": "My Garage Kit - 2233",
            "attachments": [
                {
                    "address": "ipfs://QmT1zZNHvXxdTzHesfEdvFjMPvw536Ltbup7B4ijGVib7t",
                    "mime_type": "image/jpg",
                    "size_in_bytes": 1024
                }
            ]
        }
    ]
}
```

### 6.4. 帖子列表文件示例

URI `rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/note/0`

```json
{
    "version": "v0.4.0",
    "identifier": "rss3://account:0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum/list/note/0",
    "date_created": "2021-08-17T14:36:00.676Z",
    "date_updated": "2022-02-10T22:50:53.132Z",

    "signature": "0x5b2387a7e1b2ceb1a1b0c177294ca480ec1f43a21ad627476951b0c69baece500bde043d6f3a8ff1a8e248e3216517316b397806f6a6e721df50ed43479d65651c",

    "total": 1,
    "list": [
        {
            "identifier": "rss3://note:D52DCF9F-7FF0-500A-9562-66C87DB3A866@rss3",
            "date_created": "2021-08-17T14:36:00.676Z",
            "date_updated": "2022-02-10T22:50:53.132Z",

            "links": {
                "identifiers": [
                    {
                        "type": "comment",
                        "identifier_custom": "rss3://note:D52DCF9F-7FF0-500A-9562-66C87DB3A866@rss3/list/link/comment/0",
                        "identifier": "rss3://note:D52DCF9F-7FF0-500A-9562-66C87DB3A866@rss3/list/link/comment"
                    },
                ],
                "identifier_back": "rss3://note:D52DCF9F-7FF0-500A-9562-66C87DB3A866@rss3/list/backlink"
            },

            "authors": [
                "0xC8b960D09C0078c18Dcbe7eB9AB9d816BcCa8944@ethereum",
                "0x09D9719d01f48304993b35c5b5c813DdCD622362@ethereum"
            ],
            "title": "RSS3 is born",
            "summary": "RSS3 is a next-generation feed standard that aims to support efficient and decentralized information distribution.",
            "attachments": [
                {
                    "content": "# I include a markdown",
                    "mime_type": "text/markdown"
                }, {
                    "address": "ipfs://QmT1zZNHvXxdTzHesfEdvFjMPvw536Ltbup7B4ijGVib7t",
                    "mime_type": "image/jpg",
                    "size_in_bytes": 1024
                }
            ]
        }
    ]
}
```
